# YouTube検索・分析ツール 要件定義書（MVP）

## 概要

YouTube Data API v3 を利用し、直近3〜6ヶ月以内に開設された急成長チャンネルをキーワードで探索・分析するWebアプリケーション。BYOK（ユーザー自身がAPIキーを用意・設定）を前提に、段階的フィルタリング・キャッシュ・並列処理＋レート制限・プログレッシブ表示で高速な探索体験を提供する。toC と toB は同一コア機能を共有し、出力・保存・サポートなどで差別化する。

## ユーザストーリー

### ストーリー1: 個人クリエイターの競合探索
- である 個人クリエイター として
- 私は 直近に伸びている関連チャンネルを素早く見つけたい
- そうすることで ネタの発見や差別化のヒントを得られる

### ストーリー2: 企業担当者の提案資料作成
- である マーケティング担当者/制作会社担当者 として
- 私は 条件を指定して有望なチャンネルの一覧と要約をエクスポートしたい
- そうすることで 企画・提案資料に客観的根拠を付与できる

### ストーリー3: BYOK前提の安全利用
- である すべてのユーザー として
- 私は 自分のAPIキーを安全に設定・管理したい
- そうすることで セキュリティとクォータを自分でコントロールできる

## 機能要件（EARS記法）

### 通常要件
- REQ-001: システムは ユーザーが指定した最大5件のキーワードでYouTubeチャンネル検索を実行しなければならない。
- REQ-002: システムは 検索結果に対し最低登録者数・最低総再生回数・開設日（最大6ヶ月以内）でフィルタリングしなければならない。
- REQ-003: システムは 各チャンネルの基本情報（名称・サムネイル・登録者数・総再生回数・開設日）を表示しなければならない。
- REQ-004: システムは 詳細分析対象を最大20件まで段階的に選定できるようにしなければならない。
- REQ-005: システムは 検索結果をプログレッシブに表示し、上位の一部を即時描画しなければならない。
- REQ-006: システムは API呼び出しを並列化しつつ、適切なレート制限を適用しなければならない。
- REQ-007: システムは クォータ消費をリアルタイムで概算表示しなければならない。
- REQ-008: システムは 24時間のキャッシュ（IndexedDB/LocalStorage）を活用し、同条件の再検索を高速化しなければならない。

### 条件付き要件
- REQ-101: 無料枠の条件（推奨3,000クォータ/日相当）の場合、システムは 検索ページ数を1〜2、詳細分析最大10件、動画タグ取得最大3本/CHに制限しなければならない。
- REQ-102: 有料枠の条件（推奨10,000クォータ/日相当）の場合、システムは 検索ページ数最大5、詳細分析30〜50件、動画タグ取得最大10本/CHを許可しなければならない。
- REQ-103: 「もっと見る」操作がある場合、システムは 追加10件を段階的に取得・表示しなければならない。
- REQ-104: キャッシュが有効な場合、システムは 過去の検索条件の結果を即時に提示し、バックグラウンドで更新しなければならない。
- REQ-105: APIキーが未設定の場合、システムは 検索や分析をブロックし、設定UIへ誘導しなければならない。
- REQ-106: クォータが閾値を下回る場合、システムは 追加の高コスト操作（詳細分析/タグ収集）を抑制し、ユーザーに通知しなければならない。
- REQ-107: 検索結果が閾値未満（該当なし）の場合、システムは 条件緩和の提案を表示しなければならない。

### 状態要件
- REQ-201: ローディング状態にある場合、システムは シマーエフェクトと検索フェーズ（例: 関連チャンネル抽出中/タグ収集中）を表示しなければならない。
- REQ-202: 無料枠ユーザー状態にある場合、システムは Pro/Businessへのアップセル文言を結果画面に表示しなければならない。

### オプション要件
- REQ-301: システムは toBユーザー向けに CSVエクスポートを提供してもよい（ウォーターマーク解除含む）。
- REQ-302: システムは 画面カードの画像保存（toC向け）を提供してもよい。
- REQ-303: システムは 保存セット（toC最大5件/toB最大10件）による条件保存を提供してもよい。

### 制約要件
- REQ-401: システムは YouTube Data API v3 を使用しなければならない。
- REQ-402: システムは BYOKを前提とし、APIキーをブラウザストレージに保存しなければならない（暗号化または難読化の検討を含む）。
- REQ-403: システムは YouTubeブランドガイドラインおよび利用規約に準拠しなければならない。
- REQ-404: システムは 法的文書（利用規約・プライバシーポリシー）を表示し、ローカルデータ削除手段（LocalStorage/IndexedDB）を提供しなければならない。
- REQ-405: システムは Vercel上にデプロイ可能でなければならない。

（主要要件数: 25件 = REQ-001..008, REQ-101..107, REQ-201..202, REQ-301..303, REQ-401..405）

## 非機能要件

### パフォーマンス
- NFR-001: 検索完了時間は平均30秒以内（P50<=30s, P90<=60s）。
- NFR-002: 同条件再検索時はキャッシュにより表示まで2秒以内（P50）。
- NFR-003: クォータ効率は従来比77%以上の削減を目標とする。

### セキュリティ
- NFR-101: APIキーはクライアント側でのみ保存・使用し、サーバに送信しない。
- NFR-102: HTTPS通信を強制する（Vercel設定を含む）。
- NFR-103: 外部リンク・埋め込みに対して適切なCSP/DOMPurify等の対策を講じる。

### ユーザビリティ/アクセシビリティ
- NFR-201: プログレッシブ表示とローディング状態が一貫して提示される。
- NFR-202: 主要操作はキーボード操作で達成可能（WCAG 2.1 AA準拠を目標）。
- NFR-203: エラーは画面上で分かりやすく説明と復帰手段を示す。

### 運用/デプロイ
- NFR-301: mainブランチへのマージで自動デプロイ（Vercel）される。
- NFR-302: 環境変数/APIキーに依存しないビルド（BYOK）。

## Edgeケース

### エラー処理
- EDGE-001: APIキー不正/未設定→設定ダイアログ＋無効化された実行ボタン。
- EDGE-002: APIクォータ超過/レート制限→待機/抑制と再試行バックオフ、ユーザー通知。
- EDGE-003: ネットワークエラー→指数バックオフ＋オフライン通知、キャッシュ結果の提示。
- EDGE-004: APIレスポンス欠損/不整合→フォールバック値と部分表示、ログ出力（クライアント）。

### 境界値
- EDGE-101: キーワード0件/6件以上→0件はエラー、6件以上は5件にカットして警告表示。
- EDGE-102: フィルタ閾値（登録者数/総再生回数/開設日）が極端→事前バリデーションで範囲ガード。
- EDGE-103: 詳細分析対象20件超→選択制限と案内。

## 受け入れ基準

### 機能テスト
- [ ] REQ-001: 複数キーワード（最大5）で検索し、結果が統合される。
- [ ] REQ-002: 指定した3種フィルタで結果が減少/変化する。
- [ ] REQ-003: 一覧に名称・サムネイル・数値・開設日が表示される。
- [ ] REQ-004: 詳細分析の対象選択が最大20件で制御される。
- [ ] REQ-005: 上位結果が先に表示され、残りが追従して描画される。
- [ ] REQ-006: 並列実行で速く、レート超過が発生しない（モックで検証）。
- [ ] REQ-007: 画面上でクォータ消費の概算が変化する。
- [ ] REQ-008: 24h以内の再検索で即時表示→バックグラウンド更新される。
- [ ] REQ-101: 無料枠での上限（ページ/件数/タグ本数）が適用される。
- [ ] REQ-102: 有料枠での上限緩和が適用される。
- [ ] REQ-103: 「もっと見る」で10件ずつ追加される。
- [ ] REQ-104: キャッシュ命中時に即時表示される。
- [ ] REQ-105: APIキー未設定時は実行不能で設定UIに誘導される。
- [ ] REQ-106: クォータ閾値以下で高コスト操作が抑制され通知される。
- [ ] REQ-107: 該当なし時に条件緩和の提案が表示される。
- [ ] REQ-201: ローディング時にシマーとフェーズが表示される。
- [ ] REQ-202: 無料枠でアップセル文言が表示される。
- [ ] REQ-301: toBでCSVがダウンロードでき、ウォーターマークが無効になる。
- [ ] REQ-302: 画像カードが保存できる。
- [ ] REQ-303: 保存セットが上限内で保存・復元できる。
- [ ] REQ-401: YouTube API v3で正しく動作する（モック/実機確認）。
- [ ] REQ-402: APIキーがローカル保存され、送信されないことを確認。
- [ ] REQ-403: ブランド/利用規約順守（表記・ロゴ扱い）を目視確認。
- [ ] REQ-404: 規約・PPが閲覧でき、ローカルデータ削除操作が完了する。
- [ ] REQ-405: Vercelでビルド/デプロイが成功する。

### 非機能テスト
- [ ] NFR-001/NFR-002: P50/P90の計測が達成される。
- [ ] NFR-101: APIキーがネットワークタブに現れない。
- [ ] NFR-201: 主要操作がキーボードで実行可能。
- [ ] NFR-301: mainマージで自動デプロイされる。

## 付記（実装メモ）
- フロント: React + Bootstrap / 通信: axios / データ: LocalStorage + IndexedDB。
- 並列化: Promise.allSettled + レート制限（トークンバケツ/簡易キュー）。
- キャッシュ鍵: 検索条件（正規化）＋バージョン＋タイムスタンプ（TTL 24h）。
- デプロイ: Vercel / 法的文書と削除UIを設定画面に統合。
